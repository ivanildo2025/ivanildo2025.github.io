<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Links recomendados por @ivanildo.com.br">
  <title>Links Recomendados - @ivanildo.com.br</title>
  <link rel="icon" type="image/png" href="/1.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --accent: #f56565;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      min-height: 100vh;
      padding: 20px 15px;
      line-height: 1.5;
    }
    
    .container {
      max-width: 480px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid white;
      object-fit: cover;
      margin-bottom: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    h1 {
      font-size: 2.2rem;
      margin-bottom: 8px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.4);
      font-weight: 700;
    }
    
    .username {
      color: rgba(255,255,255,0.9);
      font-size: 1.2rem;
      margin-bottom: 12px;
      font-weight: 500;
    }
    
    .bio {
      font-size: 1.05rem;
      opacity: 0.9;
      margin-bottom: 30px;
      line-height: 1.5;
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 12px;
      backdrop-filter: blur(5px);
    }
    
    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .stat-item {
      text-align: center;
      background: rgba(255,255,255,0.15);
      padding: 10px 15px;
      border-radius: 10px;
      min-width: 100px;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .category {
      margin: 25px 0 15px;
      font-size: 1.3rem;
      font-weight: 700;
      opacity: 0.95;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 8px;
      border-bottom: 2px solid rgba(255,255,255,0.2);
    }
    
    .links {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .btn {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.25);
      color: white;
      padding: 18px;
      border-radius: 16px;
      text-decoration: none;
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: flex-start;
      gap: 15px;
      transition: all 0.3s;
      cursor: pointer;
      text-align: left;
    }
    
    .btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .btn-icon {
      font-size: 1.6rem;
      min-width: 30px;
      text-align: center;
    }
    
    .btn-content {
      flex: 1;
    }
    
    .btn-title {
      font-weight: 700;
      margin-bottom: 5px;
      font-size: 1.05rem;
    }
    
    .btn-description {
      font-size: 0.9rem;
      opacity: 0.9;
      font-weight: 400;
    }
    
    .price-tag {
      background: var(--accent);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 700;
      margin-top: 8px;
      display: inline-block;
    }
    
    footer {
      margin-top: 50px;
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.7;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    
    .year-badge {
      background: rgba(255,255,255,0.1);
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      margin: 10px 0;
      display: inline-block;
    }
    
    .search-container {
      margin-bottom: 25px;
    }
    
    .search-input {
      width: 100%;
      padding: 15px 20px;
      border-radius: 12px;
      border: none;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 1rem;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .search-input::placeholder {
      color: rgba(255,255,255,0.7);
    }
    
    .no-results {
      text-align: center;
      padding: 30px;
      display: none;
    }
    
    .platform-tag {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      margin-right: 8px;
      margin-top: 8px;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.1rem;
    }
    
    .loading-spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .filter-btn {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    
    .filter-btn.active {
      background: rgba(255,255,255,0.3);
      font-weight: 600;
    }
    
    .filter-btn:hover {
      background: rgba(255,255,255,0.25);
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <a href="https://mercadolivre.com/sec/2jebRUg"><img src="/1.png" alt="ivanildo.com.br" class="avatar"/></a>
      
      <h1>Links Recomendados</h1>
      <div class="username">@ivanildo.com.br</div>
      
      <p class="bio">Produtos selecionados que eu uso e recomendo. Atualizado automaticamente!</p>
      
      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="totalLinks">0</div>
          <div class="stat-label">Links</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="categoriesCount">0</div>
          <div class="stat-label">Categorias</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="updateDate">Hoje</div>
          <div class="stat-label">Atualizado</div>
        </div>
      </div>
      
      <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="üîç Buscar produtos...">
      </div>
      
      <div class="filters" id="categoryFilters">
        <!-- Filtros ser√£o gerados dinamicamente -->
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>Carregando links...</p>
    </div>

    <div class="links" id="linksContainer">
      <!-- Links ser√£o gerados dinamicamente do CSV -->
    </div>
    
    <div class="no-results" id="noResults">
      <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.7;"></i>
      <p>Nenhum resultado encontrado.</p>
    </div>

    <footer>
      <div class="year-badge" id="currentYear"></div>
      <div style="margin-top: 10px; font-size: 0.85rem; opacity: 0.8;">
        <i class="fas fa-sync-alt"></i> Atualiza√ß√µes autom√°ticas via CSV
      </div>
      <div class="affiliate-disclaimer" style="margin-top: 15px;">
        <i class="fas fa-info-circle"></i> Links de afiliado - posso receber comiss√£o
      </div>
    </footer>
  </div>

  <script>
    // Configura√ß√µes
    const CSV_URL = 'links.csv'; // Caminho para o arquivo CSV
    const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos em milissegundos
    const CACHE_KEY = 'linksDataCache';
    
    // Elementos DOM
    const linksContainer = document.getElementById('linksContainer');
    const loadingElement = document.getElementById('loading');
    const noResults = document.getElementById('noResults');
    const searchInput = document.getElementById('searchInput');
    const categoryFilters = document.getElementById('categoryFilters');
    const totalLinksElement = document.getElementById('totalLinks');
    const categoriesCountElement = document.getElementById('categoriesCount');
    const updateDateElement = document.getElementById('updateDate');
    
    // Estado
    let allProducts = [];
    let categories = [];
    let activeCategory = 'all';
    let searchTerm = '';
    
    // Fun√ß√£o para parsear CSV
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      if (lines.length === 0) return [];
      
      const headers = lines[0].split(';').map(h => h.trim());
      const products = [];
      
      for (let i = 1; i < lines.length; i++) {
        const currentLine = lines[i].split(';');
        if (currentLine.length !== headers.length) continue;
        
        const product = {};
        headers.forEach((header, index) => {
          product[header] = currentLine[index] ? currentLine[index].trim() : '';
        });
        products.push(product);
      }
      
      return products;
    }
    
    // Fun√ß√£o para carregar dados do CSV
    async function loadCSVData() {
      try {
        // Verificar cache
        const cachedData = getCachedData();
        if (cachedData) {
          console.log('Usando dados em cache');
          return cachedData;
        }
        
        // Buscar CSV
        const response = await fetch(CSV_URL + '?t=' + Date.now()); // Cache busting
        if (!response.ok) throw new Error('Erro ao carregar CSV');
        
        const csvText = await response.text();
        const products = parseCSV(csvText);
        
        // Salvar no cache
        cacheData(products);
        
        return products;
      } catch (error) {
        console.error('Erro ao carregar CSV:', error);
        
        // Tentar carregar dados de fallback
        const fallbackData = getFallbackData();
        if (fallbackData.length > 0) {
          console.log('Usando dados de fallback');
          return fallbackData;
        }
        
        return [];
      }
    }
    
    // Cache em localStorage
    function getCachedData() {
      try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (!cached) return null;
        
        const { timestamp, data } = JSON.parse(cached);
        const now = Date.now();
        
        if (now - timestamp < CACHE_DURATION) {
          return data;
        }
        
        localStorage.removeItem(CACHE_KEY);
        return null;
      } catch (e) {
        return null;
      }
    }
    
    function cacheData(data) {
      try {
        const cacheObject = {
          timestamp: Date.now(),
          data: data
        };
        localStorage.setItem(CACHE_KEY, JSON.stringify(cacheObject));
      } catch (e) {
        console.error('Erro ao salvar cache:', e);
      }
    }
    
    // Dados de fallback (caso CSV n√£o carregue)
    function getFallbackData() {
      return [
        {
          categoria: 'Celulares e Eletr√¥nicos',
          Produto: 'Roku Streaming Stick',
          descricao: 'Transforma TV em Smart com controle voz',
          link: 'https://mercadolivre.com/sec/2vaHe4Y',
          preco: 'Oferta especial',
          plataforma: 'Mercado Livre',
          icon: 'fas fa-tv'
        },
        {
          categoria: 'Livros',
          Produto: 'Kit B√≠blia Letra Gigante',
          descricao: '2 B√≠blias luxo com √≠ndice',
          link: 'https://mercadolivre.com/sec/21QLsxF',
          preco: 'Pre√ßo especial',
          plataforma: 'Mercado Livre',
          icon: 'fas fa-bible'
        }
      ];
    }
    
    // Gerar HTML para um produto
    function createProductHTML(product) {
      return `
        <a href="${product.link}" target="_blank" class="btn" 
           data-category="${product.categoria}" 
           data-platform="${product.plataforma}">
          <div class="btn-icon"><i class="${product.icon || 'fas fa-link'}"></i></div>
          <div class="btn-content">
            <div class="btn-title">${product.Produto}</div>
            <div class="btn-description">${product.descricao}</div>
            <span class="platform-tag">${product.plataforma}</span>
            ${product.preco ? `<div class="price-tag">${product.preco}</div>` : ''}
          </div>
        </a>
      `;
    }
    
    // Gerar categorias √∫nicas
    function extractCategories(products) {
      const uniqueCategories = [...new Set(products.map(p => p.categoria))];
      return uniqueCategories.sort();
    }
    
    // Gerar filtros de categoria
    function createCategoryFilters(categories) {
      return `
        <button class="filter-btn active" data-category="all">Todos</button>
        ${categories.map(cat => `
          <button class="filter-btn" data-category="${cat}">${cat}</button>
        `).join('')}
      `;
    }
    
    // Filtrar produtos
    function filterProducts() {
      let filtered = allProducts;
      
      // Filtrar por categoria
      if (activeCategory !== 'all') {
        filtered = filtered.filter(p => p.categoria === activeCategory);
      }
      
      // Filtrar por busca
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        filtered = filtered.filter(p => 
          p.Produto.toLowerCase().includes(term) ||
          p.descricao.toLowerCase().includes(term) ||
          p.categoria.toLowerCase().includes(term) ||
          p.plataforma.toLowerCase().includes(term)
        );
      }
      
      return filtered;
    }
    
    // Renderizar produtos
    function renderProducts(products) {
      if (products.length === 0) {
        linksContainer.innerHTML = '';
        noResults.style.display = 'block';
        return;
      }
      
      noResults.style.display = 'none';
      
      // Agrupar por categoria
      const grouped = {};
      products.forEach(product => {
        if (!grouped[product.categoria]) {
          grouped[product.categoria] = [];
        }
        grouped[product.categoria].push(product);
      });
      
      // Gerar HTML
      let html = '';
      Object.keys(grouped).forEach(category => {
        html += `
          <div class="category">
            <i class="fas fa-folder"></i> ${category}
          </div>
        `;
        
        grouped[category].forEach(product => {
          html += createProductHTML(product);
        });
      });
      
      linksContainer.innerHTML = html;
      attachClickEvents();
    }
    
    // Atualizar estat√≠sticas
    function updateStats() {
      totalLinksElement.textContent = allProducts.length;
      categoriesCountElement.textContent = categories.length;
      
      const now = new Date();
      updateDateElement.textContent = now.toLocaleDateString('pt-BR');
    }
    
    // Anexar eventos de clique
    function attachClickEvents() {
      document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          this.style.transform = 'scale(0.98)';
          setTimeout(() => {
            this.style.transform = '';
          }, 150);
          
          // Registrar clique (pode enviar para analytics)
          const platform = this.getAttribute('data-platform');
          console.log(`Produto clicado: ${platform}`);
        });
      });
    }
    
    // Inicializar filtros
    function initFilters() {
      categoryFilters.innerHTML = createCategoryFilters(categories);
      
      // Evento para filtros de categoria
      categoryFilters.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          // Remover active de todos
          categoryFilters.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('active');
          });
          
          // Adicionar active no clicado
          this.classList.add('active');
          activeCategory = this.getAttribute('data-category');
          
          // Re-renderizar
          const filtered = filterProducts();
          renderProducts(filtered);
        });
      });
      
      // Evento para busca
      searchInput.addEventListener('input', function() {
        searchTerm = this.value.toLowerCase().trim();
        const filtered = filterProducts();
        renderProducts(filtered);
      });
    }
    
    // Inicializar
    async function init() {
      try {
        loadingElement.style.display = 'block';
        
        // Carregar dados
        allProducts = await loadCSVData();
        categories = extractCategories(allProducts);
        
        // Atualizar estat√≠sticas
        updateStats();
        
        // Inicializar filtros
        initFilters();
        
        // Renderizar todos os produtos inicialmente
        renderProducts(allProducts);
        
        // Atualizar t√≠tulo
        document.title = `Links Recomendados (${allProducts.length}) - @ivanildo.com.br`;
        
        // Atualizar ano
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
      } catch (error) {
        console.error('Erro na inicializa√ß√£o:', error);
        linksContainer.innerHTML = `
          <div style="text-align: center; padding: 40px;">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i>
            <p>Erro ao carregar os links. Por favor, tente novamente.</p>
          </div>
        `;
      } finally {
        loadingElement.style.display = 'none';
      }
    }
    
    // Iniciar quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', init);
    
    // Atualizar automaticamente a cada 5 minutos
    setInterval(async () => {
      console.log('Atualizando dados...');
      const freshData = await loadCSVData();
      if (freshData.length > 0) {
        allProducts = freshData;
        categories = extractCategories(allProducts);
        updateStats();
        initFilters();
        renderProducts(filterProducts());
      }
    }, CACHE_DURATION);
    
    // For√ßar atualiza√ß√£o com F5
    document.addEventListener('keydown', (e) => {
      if (e.key === 'F5') {
        localStorage.removeItem(CACHE_KEY);
      }
    });
  </script>

</body>
</html>
